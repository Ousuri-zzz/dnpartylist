# üõ°Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏¥‡∏•‡∏î‡πå (Guild System) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö DNPartyList

> ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏¥‡∏•‡∏î‡πå‡πÅ‡∏ö‡∏ö "‡∏Å‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß + ‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å"  
> ‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö trade/checklist/character ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß

---

## ‚úÖ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

- ‡πÉ‡∏ä‡πâ path `/guild` ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Å‡∏¥‡∏•‡∏î‡πå)
- ‡∏ó‡∏∏‡∏Å user ‡∏ó‡∏µ‡πà login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå (guild.leaderUid) ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå:
  - ‡∏•‡∏ö / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
  - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡πâ‡∏≤‡∏ô‡∏û‡πà‡∏≠‡∏Ñ‡πâ‡∏≤
  - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô loan ‡∏ó‡∏µ‡πà‡∏Å‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏•‡∏î‡πå
- ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°: character, party, trade, ranking

---

## üìå Step-by-Step

### ü•á Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (`/guild`)

- ‡∏™‡∏£‡πâ‡∏≤‡∏á path `/guild` ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á:
```ts
/guild = {
  name: "GalaxyCat",
  secretKey: "myGuildSecretKey",
  leaderUid: "uid ‡∏Ç‡∏≠‡∏á‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå",
  members: {
    [uid]: {
      discordName: "...",
      joinedAt: "2025-05-04T00:00:00Z"
    }
  }
}
```

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `initializeGuild(secretKey)` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å

---

### ü•à Step 2: Auto Join ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠ Login

- ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà user login:
  - ‡πÄ‡∏ä‡πá‡∏Ñ `/guild/members/[uid]`
  - ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Discord Name + joinedAt

```ts
const uid = auth.currentUser.uid
const memberRef = ref(db, `guild/members/${uid}`)
get(memberRef).then(snap => {
  if (!snap.exists()) {
    set(memberRef, {
      discordName: auth.currentUser.displayName,
      joinedAt: new Date().toISOString()
    })
  }
})
```

---

### ü•â Step 3: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ `/guild/settings`

- ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå (`auth.uid === guild.leaderUid`)
- ‡πÅ‡∏™‡∏î‡∏á:
  - ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà pending
  - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ loan ‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏Å‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏•‡∏î‡πå
- ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£:
  - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
  - ‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
  - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ / ‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
  - ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ / ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò loan

---

### üßπ Step 4: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Hard Delete)

- ‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö uid ‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î:
```ts
await remove(ref(db, `users/${uid}`))
await remove(ref(db, `characters/${uid}`))
await remove(ref(db, `tradeMerchants/${uid}`))
await remove(ref(db, `guild/members/${uid}`))
```

- ‡πÅ‡∏™‡∏î‡∏á modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö‡∏à‡∏£‡∏¥‡∏á  
- ‡∏´‡∏•‡∏±‡∏á‡∏•‡∏ö ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ login ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

---

### ‚öôÔ∏è Step 5: ‡∏õ‡∏£‡∏±‡∏ö Firebase Rules ‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå

‡πÄ‡∏û‡∏¥‡πà‡∏° rule `.write` ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏ô path:

```js
".write": "auth.uid === $uid || root.child('guild/leaderUid').val() === auth.uid"
```

‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö:
- `/users/$uid`
- `/users/$uid/characters`
- `/users/$uid/meta`
- `/tradeMerchants/$uid`

‡πÄ‡∏û‡∏¥‡πà‡∏° path ‡πÉ‡∏´‡∏°‡πà:
```js
"guild": {
  ".read": "auth != null",
  ".write": "auth != null"
}
```

---

### üßæ Step 6: ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡πâ‡∏≤‡∏ô‡∏û‡πà‡∏≠‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏á‡∏±‡∏ö

‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ `/guild/settings`:
- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ `/tradeMerchants/[uid]` ‡∏ó‡∏µ‡πà `status: "pending"`
- ‡∏õ‡∏∏‡πà‡∏° ‚Äú‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‚Äù ‚Üí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô status ‚Üí `"active"`
- ‡∏õ‡∏∏‡πà‡∏° ‚Äú‡∏£‡∏∞‡∏á‡∏±‡∏ö‚Äù ‚Üí `"suspended"`

```ts
await update(ref(db, `tradeMerchants/${uid}`), {
  status: "active"
})
```

---

## üìã ‡∏™‡∏£‡∏∏‡∏õ

| Step | ‡∏£‡∏∞‡∏ö‡∏ö | ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô |
|------|-------|----------|
| 1 | `/guild` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏•‡∏î‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß |
| 2 | auto join | ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ |
| 3 | `/guild/settings` | ‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å |
| 4 | ‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å | Hard delete ‡πÅ‡∏ö‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ |
| 5 | Firebase Rules | ‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô path ‡∏Ç‡∏≠‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ |
| 6 | ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡πâ‡∏≤‡∏ô | ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ trade system ‡∏à‡∏≤‡∏Å guild

---

## üî∞ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏ï‡πà‡∏≠
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ UI `/guild/settings`
- ‡πÄ‡∏û‡∏¥‡πà‡∏° modal ‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å / ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡πâ‡∏≤‡∏ô
- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô navbar ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå
