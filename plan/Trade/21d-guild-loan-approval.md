# üí∞ plan/21d-guild-loan-approval.md

> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ / ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏•‡∏î‡πå"  
> ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ `/guild/settings` ‡πÇ‡∏î‡∏¢‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

---

## üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ loan ‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏Å‡∏π‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏•‡∏î‡πå (`/guildLoans`)
- ‡πÅ‡∏¢‡∏Å loan ‡∏ó‡∏µ‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (pending)
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:
  - ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ
  - ‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ
  - üí∏ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß

---

## üìÅ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `/guildLoans/[loanId]`

```ts
/guildLoans/[loanId] = {
  id: "abc123",
  type: "guild", // ‡∏´‡∏£‡∏∑‡∏≠ merchant
  borrowerUid: "uid",
  amount: 5000,
  reason: "‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏•‡∏≤‡∏î",
  status: "pending" | "approved" | "rejected" | "repaid" | "confirmed",
  createdAt: "...",
  repaidAt: "...",
  confirmedBy: "‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå uid"
}
```

---

## üß© Step 1: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ loan ‡∏ó‡∏µ‡πà type = "guild"

- ‡πÉ‡∏ä‡πâ query:
```ts
query(ref(db, "guildLoans"), orderByChild("type"), equalTo("guild"))
```

- ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ `pending` ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å

---

## ‚úÖ Step 2: ‡∏õ‡∏∏‡πà‡∏° "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" / "‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò"

| ‡∏ú‡∏π‡πâ‡∏Å‡∏π‡πâ | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡∏õ‡∏∏‡πà‡∏° |
|--------|--------|--------|--------|------|
| Tester | ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ | 5000G | pending | [‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥] [‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò] |

‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß:
```ts
update(ref(db, `guildLoans/${id}`), {
  status: "approved",
  approvedAt: new Date().toISOString()
})
```

---

## üí∏ Step 3: ‡∏õ‡∏∏‡πà‡∏° "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß"

‡∏Å‡∏£‡∏ì‡∏µ status = "repaid" (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡∏î‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß) ‚Üí ‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏° ‚Äú‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‚Äù

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î:
```ts
update(ref(db, `guildLoans/${id}`), {
  status: "confirmed",
  confirmedBy: auth.currentUser.uid,
  confirmedAt: new Date().toISOString()
})
```

---

## üîê Step 4: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå

‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°:
```ts
const isLeader = (await get(ref(db, `guild/leaders/${auth.uid}`))).exists()
```

---

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ

| ‡∏õ‡∏∏‡πà‡∏° | ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÅ‡∏™‡∏î‡∏á | ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå |
|------|----------------|-----------|
| ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ | status = pending | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô approved |
| ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò | status = pending | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô rejected |
| ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß | status = repaid | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô confirmed |

---

## üî∞ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏ï‡πà‡∏≠

- ‡πÄ‡∏û‡∏¥‡πà‡∏° toast ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å action
- ‡πÅ‡∏™‡∏î‡∏á loan ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏ô `/mypage` ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
