# üõ°Ô∏è plan/21b-guild-system-multi-leader.md

> ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏¥‡∏•‡∏î‡πå (21-guild-system-complete.md)  
> ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô  
> ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô Tester (uid: 2GS9xCHpizYrEAiAEMJOc37zF1o2)  
> ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö Rules ‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

---

## ‚úÖ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á `/guild` ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà (multi leader)

```json
/guild = {
  name: "GalaxyCat",
  leaders: {
    "2GS9xCHpizYrEAiAEMJOc37zF1o2": true,
    "uid_‡∏≠‡∏∑‡πà‡∏ô": true
  },
  members: {
    "2GS9xCHpizYrEAiAEMJOc37zF1o2": {
      discordName: "Tester",
      joinedAt: "2025-05-04T10:48:56.336Z"
    }
  }
}
```

---

## ‚úçÔ∏è Step 1: ‡πÅ‡∏Å‡πâ Firebase Rules ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô

‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ rule:
```js
".write": "auth.uid === $uid || root.child('guild/leaders/' + auth.uid).val() === true"
```

‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö paths ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:
- `/users/$uid`
- `/users/$uid/characters`
- `/users/$uid/meta`
- `/tradeMerchants/$uid`
- `/guild/announcements`
- `/guild/events`

---

## üß© Step 2: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î UI

‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ:
```ts
const isLeader = (uid: string) => {
  const snapshot = await get(ref(db, `guild/leaders/${uid}`))
  return snapshot.exists()
}
```

‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô:
- ‡∏´‡∏ô‡πâ‡∏≤ `/guild/settings`
- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
- ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤

---

## ‚öôÔ∏è Step 3: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå (‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á)

‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô:
```ts
update(ref(db, `guild/leaders/${newUid}`), true)
```

‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤ `Manage Leaders` ‡∏Å‡πá‡πÑ‡∏î‡πâ (‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)

---

## üìå ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

- ‡∏•‡∏ö key ‡πÄ‡∏Å‡πà‡∏≤ `leaderUid` ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å `/guild`
- ‡πÉ‡∏ä‡πâ‡πÅ‡∏ï‡πà `leaders/[uid]` ‡πÅ‡∏ó‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà
- ‡πÉ‡∏´‡πâ Cursor refactor ‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ leaderUid ‚Üí ‡πÉ‡∏ä‡πâ leaders/[uid]

---

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ

| ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|----------------|-------------|
| ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå | ‡πÉ‡∏ä‡πâ `leaders: { uid: true }` |
| ‚úÖ ‡πÅ‡∏Å‡πâ Rules | ‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ `guild/leaders/[auth.uid] == true` |
| ‚úÖ ‡∏ï‡∏±‡πâ‡∏á Tester ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡∏Å‡∏¥‡∏•‡∏î‡πå‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å | uid: 2GS9xCHpizYrEAiAEMJOc37zF1o2 |
| ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö logic ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ | isLeader(uid) |
